<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{modules/layouts/layout :: layout(content = ~{::content}, htmlType = 'fcircle',title = ${singlePage.spec.title + ' | ' + site.title}, head = ~{::head} )}">
<th:block th:fragment="head">
  <!-- OGï¼šä¼˜å…ˆä¸»é¢˜è®¾ç½®ï¼Œå†å›è½é¡µé¢å­—æ®µ -->
  <th:block th:replace="~{modules/common/open-graph :: open-graph(
    _title    = ${ !#strings.isEmpty(theme.config.fcircle.bigTitle) ? theme.config.fcircle.bigTitle
                  : (!#strings.isEmpty(theme.config.fcircle.title) ? theme.config.fcircle.title : singlePage.spec.title) },
    _permalink= ${ singlePage.status.permalink },
    _cover    = ${
                    !#strings.isEmpty(theme.config.fcircle.backgroundImg) ? theme.config.fcircle.backgroundImg
                    : (!#strings.isEmpty(theme.config.fcircle.background) ? theme.config.fcircle.background
                    : (!#strings.isEmpty(theme.config.fcircle.bg) ? theme.config.fcircle.bg : singlePage.spec.cover))
                 },
    _excerpt  = ${
                    !#strings.isEmpty(theme.config.fcircle.detail) ? theme.config.fcircle.detail
                    : (!#strings.isEmpty(theme.config.fcircle.description) ? theme.config.fcircle.description
                    : (!#strings.isEmpty(theme.config.fcircle.desc) ? theme.config.fcircle.desc : singlePage.status.excerpt))
                 },
    _type     = 'website'
  )}"></th:block>
</th:block>

<th:block th:fragment="content">
  <div class="page" id="body-wrap">

    <!-- é¡¶éƒ¨å¯¼èˆªæ ‡é¢˜ -->
    <header class="not-top-img" id="page-header">
      <nav th:replace="~{modules/nav :: nav(
        title = ${ !#strings.isEmpty(theme.config.fcircle.bigTitle) ? theme.config.fcircle.bigTitle
                  : (!#strings.isEmpty(theme.config.fcircle.title) ? theme.config.fcircle.title : singlePage.spec.title) }
      )}"></nav>
<!-- ä¿®å¤(v5 é€šç”¨)ï¼šé±¼å¡˜å¡ç‰‡ä¸€ç›´æ˜¯æ‡’åŠ è½½å ä½å›¾æ—¶ï¼Œå°½é‡ä»ä»»ä½•å¯è§ä½ç½®æå–ç½‘å€å¹¶æ›¿æ¢ä¸ºå¯¹åº”ç«™ç‚¹å›¾æ ‡ -->
<script data-pjax id="fcircle-avatar-fallback-v5">
  (function () {
    var root = document.querySelector('#hexo-circle-of-friends-root') || document;
    if (!root) return;

    function isPlaceholder(url) {
      return /(?:^|\/)404s?\.(?:gif|png|jpe?g|webp)(?:$|\?)/i.test(url || '');
    }
    function wakeLazy() {
      try {
        if (window.lazyLoadInstance && typeof window.lazyLoadInstance.update === 'function') {
          window.lazyLoadInstance.update();
          window.lazyLoadInstance.loadAll && window.lazyLoadInstance.loadAll();
        }
      } catch (e) {}
    }
    function toFavicon(href) {
      try { var u = new URL(href, location.href); return 'https://icons.duckduckgo.com/ip3/' + u.hostname + '.ico'; }
      catch (e) { return null; }
    }
    // åœ¨èŠ‚ç‚¹åŠå…¶ç¥–å…ˆé‡Œï¼Œå°½å¯èƒ½æ‰¾ä¸€ä¸ªåŒ…å« http(s) çš„ URL
    function findAnyUrl(node) {
      var maxDepth = 6, depth = 0, el = node;
      while (el && depth++ < maxDepth) {
        // 1) data-* / ä»»ä½•å±æ€§é‡Œå‡ºç° http
        if (el.attributes) {
          for (var i = 0; i < el.attributes.length; i++) {
            var v = el.attributes[i].value;
            if (typeof v === 'string' && /^https?:\/\//i.test(v)) return v;
          }
        }
        // 2) å­å…ƒç´ é‡Œçš„é“¾æ¥
        var a = el.querySelector && el.querySelector('a[href^="http"]');
        if (a) return a.getAttribute('href');
        el = el.parentElement;
      }
      return null;
    }
    function fixImages(scope) {
      var box = scope || root;
      wakeLazy();
      var imgs = box.querySelectorAll('img');
      var fixed = 0;
      for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        if (img.dataset.fcircleFixed === '1') continue;
        var cur = img.getAttribute('src') || '';
        if (!isPlaceholder(cur)) continue;

        var real = img.getAttribute('data-lazy-src') || img.getAttribute('data-src') || img.getAttribute('data-original');
        if (!real) {
          var card = img.closest('.cf-card, .cf-item, article, li, div');
          var any = findAnyUrl(card || img);
          if (any) real = toFavicon(any);
        }
        // æœ€åå…œåº•ï¼šè‡³å°‘ç”¨æœ¬ç«™ favicon è®©å®ƒå‘ç”Ÿå˜åŒ–ï¼Œä¾¿äºç¡®è®¤è„šæœ¬åœ¨å·¥ä½œ
        if (!real) real = location.origin + '/favicon.ico';

        if (real) {
          img.referrerPolicy = 'no-referrer';
          img.setAttribute('loading', 'eager');
          img.setAttribute('decoding', 'async');
          img.src = real + (real.indexOf('?') > -1 ? '&' : '?') + 't=' + Date.now();
          img.dataset.fcircleFixed = '1';
          fixed++;
        }
      }
      // console.log('[v5] fixed', fixed);
    }
    if (document.readyState !== 'loading') fixImages();
    else document.addEventListener('DOMContentLoaded', function () { fixImages(); }, { once: true });

    var mo = new MutationObserver(function (muts) {
      for (var i = 0; i < muts.length; i++) {
        if (muts[i].addedNodes && muts[i].addedNodes.length) { fixImages(); break; }
      }
    });
    mo.observe(root, { childList: true, subtree: true });

    document.addEventListener('pjax:complete', function () { setTimeout(fixImages, 0); });
  })();
</script>

  <!-- å¼•å…¥ heo-fcircle3.css ä½†æ”¾å…¥ç‹¬ç«‹ CSS Layerï¼Œé¿å…å…¨å±€é€šç”¨è§„åˆ™è¦†ç›–é±¼å¡˜æ ·å¼ -->
  <link rel="stylesheet" th:href="${assets_link + '/libs/fcircle/heo-fcircle3.css'}" layer="heo" type="text/css">

  <!-- æœ€å°åŒ–ä¿®å¤ï¼šè‹¥ heo åœ¨éƒ¨åˆ†æµè§ˆå™¨ä»å½±å“åˆ°é±¼å¡˜å›¾ç‰‡/æ··åˆæ¨¡å¼ï¼Œè¿™é‡Œç²¾å‡†å¤åŸ -->
  <style id="fcircle-min-fix">
    #hexo-circle-of-friends-root, #hexo-circle-of-friends-root *{
      mix-blend-mode: normal;
    }
    #hexo-circle-of-friends-root img{
      filter: none;
      transform: none;
      object-fit: cover;
      background: none;
      max-width: 100%;
      height: auto;
      display: block;
    }
  </style>

    </header>

    <main class="layout hide-aside" id="content-inner">
      <div id="page">

        <!-- å¤´å›¾ç»„ä»¶ï¼šèƒŒæ™¯/å°æ ‡é¢˜/å¤§æ ‡é¢˜/æè¿° -->
        <div th:replace="~{macro/author-content :: author-content(
          background = ${
                          !#strings.isEmpty(theme.config.fcircle.backgroundImg) ? theme.config.fcircle.backgroundImg
                          : (!#strings.isEmpty(theme.config.fcircle.background) ? theme.config.fcircle.background
                          : (!#strings.isEmpty(theme.config.fcircle.bg) ? theme.config.fcircle.bg : singlePage.spec.cover))
                        },
          smallTitle = ${ !#strings.isEmpty(theme.config.fcircle.smallTitle) ? theme.config.fcircle.smallTitle
                        : (!#strings.isEmpty(theme.config.fcircle.subTitle) ? theme.config.fcircle.subTitle
                        : (!#strings.isEmpty(theme.config.fcircle.subtitle) ? theme.config.fcircle.subtitle : 'å‹é“¾')) },
          bigTitle   = ${ !#strings.isEmpty(theme.config.fcircle.bigTitle) ? theme.config.fcircle.bigTitle
                        : (!#strings.isEmpty(theme.config.fcircle.title) ? theme.config.fcircle.title : singlePage.spec.title) },
          detail     = ${
                          !#strings.isEmpty(theme.config.fcircle.detail) ? theme.config.fcircle.detail
                          : (!#strings.isEmpty(theme.config.fcircle.description) ? theme.config.fcircle.description
                          : (!#strings.isEmpty(theme.config.fcircle.desc) ? theme.config.fcircle.desc : singlePage.spec.excerpt.raw))
                        },
          buttonUrl  = ${ !#strings.isEmpty(theme.config.fcircle.buttonUrl) ? theme.config.fcircle.buttonUrl : site.url },
          buttonTitle= ${ !#strings.isEmpty(theme.config.fcircle.buttonTitle) ? theme.config.fcircle.buttonTitle : 'éƒ¨ç½²é¡¹ç›®' }
        )}"></div>

        <!-- ğŸ£ é’“é±¼ -->
        <th:block th:if="${theme.config.fcircle.fcircleRandomFriendsEnable}">
          <div class="title-h2-a">
            <div class="title-h2-a-left">
              <h2 style="padding-top:0;margin:.6rem 0 .6rem">ğŸ£ é’“é±¼</h2>
              <a class="random-post-start" href="javascript:fetchRandomPost();">
                <i class="haofont hao-icon-arrow-rotate-right"></i>
              </a>
            </div>
            <div th:if="${not #strings.isEmpty(theme.config.link.linksUrl)}" class="title-h2-a-right">
              <a class="random-post-all" th:href="${theme.config.link.linksUrl}">å…¨éƒ¨å‹é“¾</a>
            </div>
          </div>
          <div id="random-post"></div>
          <script>
            var fdataUser = {
              apiurl: "[(${theme.config.fcircle.apiurl})]",
              defaultFish: 500,
              hungryFish: 500,
            };
          </script>
          <script th:src="${assets_link + '/libs/moments/random-friends-post.js'}"></script>
        </th:block>

        <!-- ğŸŸ é±¼å¡˜ -->
        <div class="title-h2-a">
          <div class="title-h2-a-left">
            <h2 style="padding-top:0;margin:.6rem 0 .6rem">ğŸŸ é±¼å¡˜</h2>
          </div>
          <div class="title-h2-a-right"><span>ä»¥ä¸‹å†…å®¹è‡ªåŠ¨ç”Ÿæˆï¼Œæœªç»å®¡æ ¸</span></div>
        </div>

        <div id="hexo-circle-of-friends-root"></div>
        <script>
          var UserConfig = {
            private_api_url: "[(${theme.config.fcircle.apiurl})]",  // è¿™é‡Œå¡«çº¯åŸºå€ï¼Œå¦‚ https://hao-yutang.vercel.app æˆ– /api
            page_turning_number: 12,
            error_img: "https://sdn.geekzu.org/avatar/57d8260dfb55501c37dde588e7c3852c",
            sort_rule: "created"
          };
        </script>
        <link rel="stylesheet" th:href="${assets_link + '/libs/moments/heoMainColor.css'}">
        <script th:src="${assets_link + '/libs/moments/app.min.js'}"></script>
        <script th:src="${assets_link + '/libs/moments/bundle.js'}"></script>

        <style>
          .cf-manage-pannel[data-v-34921c7c]{width:80%!important;height:80%!important}
          .cf-article-author:hover{color:var(--heo-card-bg)!important}
          #cf-more:hover{background:var(--heo-lighttext)!important;color:var(--heo-card-bg)!important}
        </style>

      </div>
    </main>

    <footer th:replace="~{modules/footer}"/>
    <script th:if="${theme.config.other.bubbleEnable}" async data-pjax th:src="${assets_link + '/libs/canvas/bubble.js'}"></script>
  </div>
</th:block>
</html>
