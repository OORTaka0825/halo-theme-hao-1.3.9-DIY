<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="footer-style-one">

  <script th:if="${theme.config.footer.footerContent.style_one.runtime_enable}" async="async">
    (function () {
      // 设置网站上线时间
      var grt = new Date("[[${#strings.arraySplit(theme.config.basics.siteStartTime, '-')[1]}]]/[[${#strings.arraySplit(theme.config.basics.siteStartTime, '-')[2]}]]/[[${#strings.arraySplit(theme.config.basics.siteStartTime, '-')[0]}]] 00:00:00");
      var now = new Date();
      var dnum, hnum, mnum, snum, nowHour, t, n;

      // 计算各项时间 & 旅行者1号
      function updateTime() {
        now = new Date();
        nowHour = now.getHours();

        var days = (now - grt) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);

        var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
        hnum = Math.floor(hours);
        if (String(hnum).length === 1) hnum = "0" + hnum;

        var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
        mnum = Math.floor(minutes);
        if (String(mnum).length === 1) mnum = "0" + mnum;

        var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
        snum = Math.round(seconds);
        if (String(snum).length === 1) snum = "0" + snum;

        // 旅行者1号距离（原有公式）
        t = Math.trunc(234e8 + (now - grt) / 1e3 * 17);
        n = (t / 1496e5).toFixed(6);
      }

      // 更新页面 HTML
      function updateHtml() {
        const footer = document.getElementById("footer");
        if (!footer) return;

        let img = "", description = "";
        // 白天(上班时间) / 夜晚(下班时间)
        if (nowHour < 18 && nowHour >= 9) {
          img = "[(${theme.config.footer.footerContent.style_one.work_img})]";
          description = "[(${theme.config.footer.footerContent.style_one.work_description})]";
        } else {
          img = "[(${theme.config.footer.footerContent.style_one.offduty_img})]";
          description = "[(${theme.config.footer.footerContent.style_one.offduty_description})]";
        }

        // 仅在白天给整块文字加蓝色；夜晚不加样式，走主题默认色
        const colorStyle = (nowHour < 18 && nowHour >= 9) ? ' style="color:#22a6c9;"' : '';

        if (document.getElementById("workboard")) {
          const currentTimeHtml = `
            <img class="workSituationImg boardsign" src="${img}" alt="${description}" title="${description}">
            <div id="runtimeTextTip"${colorStyle}>
              本站苟延残喘了 ${dnum} 天
              <span id="runtime"> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span>
              <i class="haofont hao-icon-heartbeat" style="color:red"></i>
              <br>
              旅行者 1 号当前距离地球 ${t} 千米，约为 ${n} 个天文单位 🚀
            </div>
          `;
          document.getElementById("workboard").innerHTML = currentTimeHtml;
        }
      }

      // 定时刷新
      setInterval(function () {
        updateTime();
        updateHtml();
      }, 1000);
    })();
  </script>

</th:block>

</html>
