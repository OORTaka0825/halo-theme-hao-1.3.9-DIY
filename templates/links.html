<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{modules/layouts/layout :: layout(content = ~{::content}, htmlType = 'links',title = ${'友链' + ' | ' + site.title}, head = ~{::head})}">
<th:block th:fragment="head">
    <th:block th:replace="~{modules/common/open-graph :: open-graph(_title = '友链',
                _permalink = '/links',
                _cover = ${theme.config.other.opengraph.image},
                _excerpt = ${site.seo.description},
                _type = 'website')}"></th:block>
</th:block>
<th:block th:fragment="content">

    <div class="page" id="body-wrap">
        <header class="not-top-img" id="page-header">
            <nav th:replace="~{modules/nav :: nav(title = '友链')}"></nav>
            <link rel="stylesheet" type="text/css" th:href="${assets_link + '/libs/fcircle/heo-fcircle3.css'}">

        </header>
        <main class="layout hide-aside" id="content-inner">
            <div id="page">
                <th:block th:replace="~{macro/content-links :: content-links(${htmlType})}" />
                <!-- 推荐博客分页 v4（主题色交互；无跳动；分页条居中） -->
                <style id="flink-pager-style-v4">
                  .flink-pager-bar{
                    display:flex; align-items:center; justify-content:center; gap:.5rem;
                    margin: 1rem auto 0; width: max-content;
                  }
                  .flink-pager-bar button{
                    padding:.42rem .9rem; border-radius:.8rem; 
                    border: var(--style-border);
                    background: var(--heo-card-bg);
                    color: var(--heo-fontcolor);
                    cursor: pointer;
                    transition: background .2s ease, color .2s ease, border-color .2s ease, transform .1s ease;
                  }
                  .flink-pager-bar button:hover{
                    background: var(--heo-theme);
                    border-color: var(--heo-theme);
                    color: var(--heo-white);
                    transform: translateY(-1px);
                  }
                  .flink-pager-bar button:active{
                    transform: translateY(0);
                  }
                  .flink-pager-bar button[disabled]{
                    opacity:.5; cursor:not-allowed;
                    transform: none;
                  }
                  .flink-pager-bar .num{
                    min-width:3.2rem; text-align:center; 
                    color: var(--heo-secondtext);
                  }
                </style>
                <script data-pjax>
                (()=>{
                  function initFlinkPagerV4(){
                    const titles = Array.from(document.querySelectorAll('#page h1, #page h2, #page h3, #page .tag-title, #page .section-title'));
                    const title = titles.find(el => /推荐博客/.test(el.textContent.trim()));
                    if(!title) return;

                    // 找到卡片容器
                    let container = title.nextElementSibling;
                    let guard = 0;
                    while(container && guard < 10){
                      const count = (container.children || []).length;
                      if(count >= 10) break;
                      container = container.nextElementSibling;
                      guard++;
                    }
                    if(!container || container.dataset.flinkPager === 'on') return;
                    container.dataset.flinkPager = 'on';

                    const items = Array.from(container.children).filter(el => el.nodeType === 1);
                    const pageSize = 21;
                    if(items.length <= pageSize) return;

                    // 分页条
                    const bar = document.createElement('div');
                    bar.className = 'flink-pager-bar';
                    const prev = document.createElement('button'); prev.textContent = '上一页';
                    const info = document.createElement('span'); info.className='num';
                    const next = document.createElement('button'); next.textContent = '下一页';
                    bar.append(prev, info, next);
                    container.appendChild(bar);

                    let pageIndex = 1;
                    const pageCount = Math.max(1, Math.ceil(items.length / pageSize));

                    function render(){
                      const start = (pageIndex-1) * pageSize;
                      const end = start + pageSize;
                      for(let i=0;i<items.length;i++){
                        items[i].style.display = (i>=start && i<end) ? '' : 'none';
                      }
                      info.textContent = pageIndex + ' / ' + pageCount;
                      prev.disabled = pageIndex<=1;
                      next.disabled = pageIndex>=pageCount;
                    }

                    render();

                    // 锁容器高度避免翻页抖动
                    const baseH = container.getBoundingClientRect().height;
                    container.style.minHeight = baseH + 'px';

                    // 交互：保持视口不动
                    prev.addEventListener('click', (e)=>{ e.preventDefault(); if(pageIndex>1){ pageIndex--; render(); }});
                    next.addEventListener('click', (e)=>{ e.preventDefault(); if(pageIndex<pageCount){ pageIndex++; render(); }});
                  }

                  if(document.readyState !== 'loading') initFlinkPagerV4();
                  else document.addEventListener('DOMContentLoaded', initFlinkPagerV4);
                  document.addEventListener('pjax:complete', initFlinkPagerV4);
                })();
                </script>
                <!-- 随机访问修复（自适配 & PJAX 兼容） -->
                <script data-pjax>
                (()=>{
                  function collectFriendLinks(){
                    const set = new Set();
                    const selfHost = location.host.replace(/^www\./,'');
                    // 只在正文区域抓外链
                    document.querySelectorAll('#page a[href^="http"]').forEach(a=>{
                      try{
                        const u = new URL(a.href, location.href);
                        const host = u.host.replace(/^www\./,'');
                        if(host === selfHost) return;                       // 排除本站
                        if(/申请友链|友链申请|apply/i.test(a.textContent||'')) return; // 排除“申请友链”
                        // 粗略排除顶部工具按钮
                        if(a.closest('#page-header')) return;
                        set.add(u.href);
                      }catch(e){}
                    });
                    return Array.from(set);
                  }
                  function bindRandomVisit(){
                    // 找按钮（文本优先）
                    let btn = Array.from(document.querySelectorAll('a,button'))
                      .find(el => /随机访问/.test((el.textContent||'').trim()));
                    if(!btn) btn = document.querySelector('.link-random, .random-link, [data-random-link]');
                    if(!btn || btn.dataset.randBound === '1') return;
                    btn.dataset.randBound = '1';
                    btn.addEventListener('click', (e)=>{
                      e.preventDefault();
                      const pool = collectFriendLinks();
                      if(!pool.length) return;
                      const url = pool[Math.floor(Math.random()*pool.length)];
                      window.open(url, '_blank', 'noopener');
                    }, {passive:false});
                  }
                  function init(){ bindRandomVisit(); }
                  if(document.readyState !== 'loading') init();
                  else document.addEventListener('DOMContentLoaded', init);
                  document.addEventListener('pjax:complete', init);
                })();
                </script>



                <hr/>
                <!--/* 评论组件 */-->
                <th:block
                        th:replace="~{modules/comment :: comment(group = 'content.halo.run',
                  kind = 'SinglePage',
                  name = 'links',
                  allowComment = true)}"/>

                <style>
                    /*修复友链页面表情选择器无法显示完全的bug*/
                    .tk-submit {
                        overflow: inherit !important;
                    }
                </style>

            </div>
        
<!-- 仅 /links：彻底禁用懒加载（严格版） -->
<script data-pjax id="links-nolazy-strict">
(function(){
  function isLinks(){ try{ return location.pathname.replace(/\/+$/,'').endsWith('/links'); }catch(e){ return true; } }

  // 1) 阻止常见懒加载库在本页自动初始化（lazysizes）
  if(isLinks()){
    window.lazySizesConfig = window.lazySizesConfig || {};
    window.lazySizesConfig.init = false;
    // 拦截懒加载触发事件（即使库已注入）
    document.addEventListener('lazybeforeunveil', function(e){ if(isLinks()) e.preventDefault(); }, true);
  }

  function swapAttrsOnce(){
    if(!isLinks()) return;
    const wrap = document.querySelector('#page') || document;

    // A) <img>：只要存在 data-src / data-original / data-lazy-src，就无条件替换为 src；同理处理 srcset
    wrap.querySelectorAll('img').forEach(function(img){
      const ds  = img.getAttribute('data-src') || img.getAttribute('data-original') || img.getAttribute('data-lazy-src');
      const dss = img.getAttribute('data-srcset') || img.getAttribute('data-lazy-srcset');
      if(ds){ img.setAttribute('src', ds); }
      if(dss){ img.setAttribute('srcset', dss); }
      ['data-src','data-original','data-lazy-src','data-srcset','data-lazy-srcset'].forEach(a=>img.removeAttribute(a));
      img.classList.remove('lazyload','lazy','lozad','lazyloaded','lazyloading');
      img.setAttribute('loading','eager'); img.setAttribute('decoding','sync');
    });

    // B) <source>：同理
    wrap.querySelectorAll('source[data-srcset]').forEach(function(s){
      s.setAttribute('srcset', s.getAttribute('data-srcset'));
      s.removeAttribute('data-srcset');
    });

    // C) 背景图懒加载（若有 data-bg / data-background-image）
    wrap.querySelectorAll('[data-bg],[data-background-image]').forEach(function(el){
      const url = el.getAttribute('data-bg') || el.getAttribute('data-background-image');
      if(url){ el.style.backgroundImage = 'url(\"'+url+'\ ")'; }
      el.removeAttribute('data-bg'); el.removeAttribute('data-background-image');
      el.classList.remove('lazyload','lazy','lozad','lazyloaded','lazyloading');
    });
  }

  function run(){ swapAttrsOnce(); }

  if(document.readyState !== 'loading') run();
  else document.addEventListener('DOMContentLoaded', run, { once:true });
  document.addEventListener('pjax:complete', run);
})();
</script>
</main>
        <!-- 底部 -->
        <footer th:replace="~{modules/footer}"/>
    </div>

</th:block>

</html>